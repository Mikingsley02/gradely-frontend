<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>‚ûï Create Student | Gradely Info</title>
  <!-- Load xlsx from CDN -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 30px 10px;
      color: #333;
      min-height: 100vh;
    }
    .form-card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      max-width: 480px;
      width: 100%;
      margin-bottom: 40px;
      overflow: hidden;
    }
    .form-header {
      background: #0c2461;
      color: white;
      padding: 25px;
      text-align: center;
    }
    .form-header h2 { font-size: 1.5rem; font-weight: 600; }
    .form-body { padding: 25px; }
    .form-group { margin-bottom: 18px; }
    label {
      display: block;
      font-weight: 600;
      margin-bottom: 6px;
      font-size: 0.9rem;
      color: #2c3e50;
    }
    input, select {
      width: 100%;
      padding: 12px;
      border: 1px solid #bdc3c7;
      border-radius: 6px;
      font-size: 1rem;
      transition: 0.3s;
    }
    input:focus { border-color: #3498db; outline: none; }
    .form-actions { display: flex; gap: 10px; margin-top: 10px; }
    button {
      flex: 1;
      padding: 12px;
      border: none;
      border-radius: 6px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s;
    }
    .btn-submit { background: #3498db; color: #fff; }
    .btn-submit:hover { background: #2980b9; }
    .btn-cancel { background: #95a5a6; color: #fff; }
    .btn-cancel:hover { background: #7f8c8d; }
    .message {
      margin-top: 15px;
      font-size: 0.95rem;
      text-align: center;
      min-height: 20px;
    }
    .error { color: #e74c3c; }
    .success { color: #27ae60; }
    /* Bulk Upload Section */
    .bulk-upload {
      background: white;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
      max-width: 480px;
      width: 100%;
      padding: 25px;
    }
    .bulk-upload h3 {
      color: #0c2461;
      font-size: 1.3rem;
      margin-bottom: 10px;
      text-align: center;
    }
    .bulk-upload p {
      font-size: 0.9rem;
      color: #555;
      text-align: center;
      margin-bottom: 15px;
    }
    .bulk-upload input[type="file"] {
      width: 100%;
      height: 45px;
      border-radius: 6px;
      border: 1px solid #bdc3c7;
      padding: 10px;
      cursor: pointer;
      margin-bottom: 15px;
    }
    .bulk-upload button {
      width: 100%;
      height: 45px;
      margin-bottom: 10px;
      background: #0a84ff;
      color: #fff;
      border-radius: 6px;
      border: none;
      font-weight: 600;
      cursor: pointer;
    }
    .bulk-upload button:hover { background: #006edc; }
    .footer {
      text-align: center;
      padding: 15px;
      font-size: 0.8rem;
      color: #eee;
    }
  </style>
</head>
<body>

  <!-- Single Student Registration -->
  <div class="form-card">
    <div class="form-header">
      <h2>‚ûï Create Student Account</h2>
      <p>Register a new student</p>
    </div>

    <div class="form-body">
      <form id="createForm">
        <div class="form-group">
          <label>Student ID *</label>
          <input type="text" name="student_id" placeholder="e.g., STD001" required />
        </div>
        <div class="form-group">
          <label>First Name *</label>
          <input type="text" name="first_name" placeholder="Amina" required />
        </div>
        <div class="form-group">
          <label>Middle Name</label>
          <input type="text" name="middle_name" placeholder="Fatimah" />
        </div>
        <div class="form-group">
          <label>Last Name *</label>
          <input type="text" name="last_name" placeholder="Johnson" required />
        </div>
        <div class="form-group">
          <label>Class *</label>
          <input type="text" name="class" placeholder="JSS 3" required />
        </div>
        <div class="form-group">
          <label>Section</label>
          <input type="text" name="section" placeholder="B" />
        </div>
        <div class="form-group">
          <label>Phone Number *</label>
          <input type="text" name="phone_number" placeholder="e.g., 08012345678" required />
        </div>
        <div class="form-group">
          <label>Parent Email</label>
          <input type="email" name="parent_email" placeholder="parent@mail.com" />
        </div>
        <div class="form-group">
          <label>Password *</label>
          <input type="text" name="password" placeholder="Enter password" required />
        </div>

        <div class="form-actions">
          <button type="button" class="btn-cancel" onclick="goBack()">Cancel</button>
          <button type="submit" class="btn-submit">Create Account</button>
        </div>

        <div class="message" id="message"></div>
      </form>
    </div>
  </div>

  <!-- Bulk Upload Section -->
  <div class="bulk-upload">
    <h3>üìÇ Bulk Upload Students</h3>
    <p>Download the Excel template and upload student data in bulk.</p>

    <input type="file" id="bulkFile" accept=".csv, .xls, .xlsx" />
    <button onclick="downloadStudentTemplate()">‚¨áÔ∏è Download Template</button>
    <button onclick="uploadBulkStudents()">üì§ Upload Students</button>

    <!-- Back to Manage Students -->
    <div style="text-align:center; margin-top:10px;">
      <a href="manage-students.html"
         style="display:inline-block; background:#0c2461; color:white; padding:10px 20px; border-radius:6px; text-decoration:none; font-weight:600;">
         ‚Üê Back to Manage Students
      </a>
    </div>

    <div class="message" id="bulkMessage"></div>
  </div>

  <div class="footer">
    &copy; 2025 <strong>gradely.info</strong>. All rights reserved.
    <div style="margin-top: 10px;">
      <a href="terms.html" style="color: #00d2ff; text-decoration: none; margin: 0 10px;">Terms of Service</a> ‚Ä¢
      <a href="privacy.html" style="color: #00d2ff; text-decoration: none; margin: 0 10px;">Privacy Policy</a> ‚Ä¢
      <a href="refund-policy.html" style="color: #00d2ff; text-decoration: none; margin: 0 10px;">Refund Policy</a>
    </div>
  </div>

  <script>
    const API_BASE = "https://gradely-backend-7xoh.onrender.com";

    // ‚úÖ Create Single Student
    document.getElementById('createForm').onsubmit = async (e) => {
      e.preventDefault();
      const data = Object.fromEntries(new FormData(e.target));
      const msgEl = document.getElementById('message');

      msgEl.textContent = "‚è≥ Creating student...";
      msgEl.className = "message";

      try {
        const res = await fetch(`${API_BASE}/api/admin/create-student`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });

        const result = await res.json().catch(() => ({ success: false, message: "Invalid JSON response" }));

        if (result.success) {
          msgEl.className = 'message success';
          msgEl.textContent = result.message || '‚úÖ Student created successfully!';
          e.target.reset();
          setTimeout(() => window.location.href = 'manage-students.html', 1500);
        } else {
          msgEl.className = 'message error';
          msgEl.textContent = '‚ùå ' + (result.message || 'Failed to create student.');
        }
      } catch (err) {
        console.error("Frontend error:", err);
        msgEl.className = 'message error';
        msgEl.textContent = '‚ö†Ô∏è Could not connect to server.';
      }
    };

    function goBack() {
      window.location.href = "dashboard.html";
    }

    // ‚úÖ Download Excel Template
    function downloadStudentTemplate() {
      const wb = XLSX.utils.book_new();
      const ws = XLSX.utils.aoa_to_sheet([
        ["student_id", "first_name", "middle_name", "last_name", "class", "section", "phone_number", "parent_email", "password"],
        ["STD001", "Amina", "Fatimah", "Johnson", "JSS 1", "B", "08012345678", "parent@mail.com", "12345"]
      ]);
      XLSX.utils.book_append_sheet(wb, ws, "Students");
      XLSX.writeFile(wb, "Student_Bulk_Template.xlsx");
    }

    // ‚úÖ Bulk Upload Students
    async function uploadBulkStudents() {
      const fileInput = document.getElementById('bulkFile');
      const file = fileInput.files[0];
      const msgEl = document.getElementById('bulkMessage');

      if (!file) {
        msgEl.className = 'message error';
        msgEl.textContent = '‚ö†Ô∏è Please select a file first.';
        return;
      }

      msgEl.textContent = "‚è≥ Uploading file...";
      msgEl.className = "message";

      const reader = new FileReader();
      reader.onload = async (e) => {
        try {
          const data = new Uint8Array(e.target.result);
          const workbook = XLSX.read(data, { type: "array" });
          const sheet = workbook.Sheets[workbook.SheetNames[0]];
          const jsonData = XLSX.utils.sheet_to_json(sheet);

          if (!jsonData.length) {
            msgEl.className = 'message error';
            msgEl.textContent = '‚ö†Ô∏è File is empty.';
            return;
          }

          const res = await fetch(`${API_BASE}/api/admin/bulk-create-students`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ students: jsonData })
          });

          const result = await res.json().catch(() => ({ success: false, message: "Invalid JSON response" }));

          if (result.success) {
            msgEl.className = 'message success';
            msgEl.textContent = `‚úÖ Successfully uploaded ${jsonData.length} student(s)!`;
            fileInput.value = "";
          } else {
            msgEl.className = 'message error';
            msgEl.textContent = '‚ùå ' + (result.message || "Upload failed.");
          }
        } catch (err) {
          console.error("Bulk upload error:", err);
          msgEl.className = 'message error';
          msgEl.textContent = 'üö´ Upload failed. Check console for details.';
        }
      };
      reader.readAsArrayBuffer(file);
    }
  </script>

<script src="js/kaima-chatbot.js"></script> 
<script src="js/session-timeout.js"></script>


</body>
</html>
