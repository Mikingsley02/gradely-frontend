<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üí≥ Subscribe | Gradely Info</title>
  <script src="https://js.paystack.co/v1/inline.js"></script>
  <style>
    /* Same styles as before */
  </style>
</head>
<body>
  <div class="container">
    <div class="box">
      <h2 id="pageTitle">üí≥ Subscribe to Gradely</h2>
      <p id="planDetails"></p>
      <div id="contextNotice" style="display:none; margin-top:15px; padding:12px; background:rgba(0,0,0,0.2); border-radius:8px;">
        <strong>üîÑ Recurring Billing</strong><br>
        Your card will be charged automatically every month. Cancel anytime.
      </div>
    </div>

    <div class="box">
      <h3>Secure Payment</h3>
      <button id="paystackBtn">üí≥ Subscribe with Paystack</button>
      <br><br>
      <button id="freeBtn" class="btn-free">Test Subscription (Dev Only)</button>
    </div>

    <a href="subscription.html" class="back-btn">‚Üê Back</a>
  </div>

  
<script>
  console.log("=== PAY.HTML INIT ===");
  const params = new URLSearchParams(window.location.search);
  const plan = params.get("plan") || "pro";
  const isUpgrade = params.get("upgrade") === "true";
  const isRenew = params.get("renew") === "true";
  
  let school_id = params.get("school_id");
  if (!school_id) school_id = localStorage.getItem("school_id");
  if (!school_id) school_id = sessionStorage.getItem("school_id");
  
  if (!school_id) {
    document.querySelector('.container').insertAdjacentHTML('afterbegin', `
      <div class="error-box">
        <strong>‚ùå Error: School ID not found</strong><br>
        Please go back to the subscription page and try again.
      </div>
    `);
    setTimeout(() => location.href = "subscription.html", 5000);
    throw new Error("School ID not found");
  }

  // ‚úÖ YOUR PAYSTACK PAYMENT LINKS - DIRECT LINKS
  const PAYMENT_LINKS = {
    basic: 'https://paystack.shop/pay/jeh3ez58fz',
    pro: 'https://paystack.shop/pay/3xxw3ze66-'
  };

  // Display plan info
  const planNames = { basic: 'Basic', pro: 'Pro' };
  const planPrices = { basic: '‚Ç¶16,800', pro: '‚Ç¶19,200' };
  document.getElementById("planDetails").textContent = `${planPrices[plan]} for ${planNames[plan]} Plan - Per Term`;

  // Set context notice
  const noticeEl = document.getElementById('contextNotice');
  if (isUpgrade) {
    document.getElementById("pageTitle").textContent = "‚ú® Upgrade to Pro Plan";
    noticeEl.style.display = "block";
    noticeEl.innerHTML = `<strong>‚ú® Upgrade in Progress</strong><br>Your account will be upgraded from Basic to Pro after payment.`;
  } else if (isRenew) {
    document.getElementById("pageTitle").textContent = "üí≥ Subscribe to Gradely";
    noticeEl.style.display = "block";
    noticeEl.innerHTML = `<strong>üí≥ Subscription Setup</strong><br>Your account will be activated with ${planNames[plan]} plan after payment.`;
  } else {
    document.getElementById("pageTitle").textContent = "üí≥ Subscribe to Gradely";
  }

  // ‚úÖ PAYSTACK BUTTON - REDIRECT TO YOUR PAYMENT LINKS
  document.getElementById("paystackBtn").onclick = () => {
    const paymentLink = PAYMENT_LINKS[plan];
    
    if (!paymentLink) {
      alert(`‚ùå Payment link not found for ${plan} plan`);
      return;
    }
    
    console.log(`üí≥ Redirecting to ${plan} payment link:`, paymentLink);
    
    // Open payment link in same window
    window.location.href = paymentLink;
  };

  // Test button (optional - can remove in production)
  document.getElementById("freeBtn").onclick = async () => {
    if (!confirm("‚ö†Ô∏è TEST MODE: This will reactivate your subscription without payment. Continue?")) return;
    
    const res = await fetch('https://api.gradely.info/api/subscription/reactivate', {
      method: "POST",
      credentials: 'include',
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ school_id, plan })
    }).then(r => r.json());

    if (res.success) {
      alert(`‚úÖ TEST SUCCESS: Your ${planNames[plan]} subscription is now active!`);
      location.href = "dashboard.html";
    } else {
      alert(`‚ùå TEST FAILED: ${res.message || 'Unknown error'}`);
    }
  };


</script>

</body>
</html>