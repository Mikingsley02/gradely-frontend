<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Create Timetable â€” Pro</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f6f7fb;
      padding: 20px;
    }

    h1 {
      margin-bottom: 10px;
    }

    .pro-badge {
      color: #fff;
      background: #6c3cff;
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 12px;
      margin-left: 8px;
    }

    .card {
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      max-width: 900px;
      margin: auto;
      box-shadow: 0 10px 30px rgba(0,0,0,.05);
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 15px;
      margin-bottom: 15px;
    }

    select, input, button {
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      width: 100%;
    }

    button {
      background: #6c3cff;
      color: #fff;
      border: none;
      cursor: pointer;
    }

    button:hover {
      opacity: 0.9;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 25px;
    }

    th, td {
      padding: 10px;
      border-bottom: 1px solid #eee;
      text-align: left;
    }

    th {
      background: #fafafa;
    }

    .danger {
      background: #ff4d4f;
    }

    .locked {
      text-align: center;
      padding: 50px;
    }
  </style>
</head>
<body>

<div id="app"></div>

<script>
/* ===============================
   AUTH / PLAN CHECK
================================ */
const school_id = localStorage.getItem("school_id");
const userPlan  = localStorage.getItem("plan"); // MUST be set at login

if (!school_id) {
  document.body.innerHTML = "<h2>Unauthorized</h2>";
  throw new Error("No school ID");
}

if (userPlan !== "pro") {
  document.getElementById("app").innerHTML = `
    <div class="card locked">
      <h2>ðŸš« Pro Feature</h2>
      <p>Timetable creation is available on the <strong>Pro Plan</strong>.</p>
      <a href="/upgrade.html">Upgrade Now</a>
    </div>
  `;
  throw new Error("Not Pro");
}

/* ===============================
   UI
================================ */
document.getElementById("app").innerHTML = `
  <div class="card">
    <h1>Create Timetable <span class="pro-badge">PRO</span></h1>

    <div class="grid">
      <input id="className" placeholder="Class (e.g. JSS 1)" />

      <select id="day">
        <option value="">Day</option>
        <option>Monday</option>
        <option>Tuesday</option>
        <option>Wednesday</option>
        <option>Thursday</option>
        <option>Friday</option>
      </select>

      <select id="timeSlot">
        <option value="">Time Slot</option>
        <option>8:00 - 9:00</option>
        <option>9:00 - 10:00</option>
        <option>10:00 - 11:00</option>
        <option>11:00 - 12:00</option>
        <option>12:00 - 1:00</option>
      </select>

      <select id="subject"></select>

      <input id="teacher" placeholder="Teacher (optional)" />
    </div>

    <button onclick="addSlot()">âž• Add to Timetable</button>

    <table>
      <thead>
        <tr>
          <th>Day</th>
          <th>Time</th>
          <th>Subject</th>
          <th>Teacher</th>
          <th></th>
        </tr>
      </thead>
      <tbody id="timetable"></tbody>
    </table>
  </div>
`;

/* ===============================
   LOAD SUBJECTS
================================ */
async function loadSubjects() {
  const res = await fetch(
    `/api/subjects/subjects?school_id=${school_id}`
  );
  const data = await res.json();

  const subjectSelect = document.getElementById("subject");
  subjectSelect.innerHTML = `<option value="">Subject</option>`;

  data.subjects.forEach(s => {
    subjectSelect.innerHTML += `
      <option value="${s.id}">${s.subject_name}</option>
    `;
  });
}

/* ===============================
   LOAD TIMETABLE
================================ */
async function loadTimetable() {
  const className = document.getElementById("className").value;
  if (!className) return;

  const res = await fetch(
    `/api/timetable?school_id=${school_id}&class=${encodeURIComponent(className)}`
  );
  const data = await res.json();

  const tbody = document.getElementById("timetable");
  tbody.innerHTML = "";

  data.timetable.forEach(row => {
    tbody.innerHTML += `
      <tr>
        <td>${row.day}</td>
        <td>${row.time_slot}</td>
        <td>${row.subject}</td>
        <td>${row.teacher || "-"}</td>
        <td>
          <button class="danger" onclick="deleteSlot(${row.id})">Delete</button>
        </td>
      </tr>
    `;
  });
}

/* ===============================
   ADD SLOT
================================ */
async function addSlot() {
  const payload = {
    school_id,
    class: document.getElementById("className").value,
    day: document.getElementById("day").value,
    time_slot: document.getElementById("timeSlot").value,
    subject_id: document.getElementById("subject").value,
    teacher: document.getElementById("teacher").value
  };

  if (!payload.class || !payload.day || !payload.time_slot || !payload.subject_id) {
    alert("Please fill all required fields");
    return;
  }

  const res = await fetch("/api/timetable", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  });

  const data = await res.json();

  if (!data.success) {
    alert(data.message || "Failed to add slot");
    return;
  }

  loadTimetable();
}

/* ===============================
   DELETE SLOT
================================ */
async function deleteSlot(id) {
  if (!confirm("Delete this timetable slot?")) return;

  await fetch(`/api/timetable/${id}?school_id=${school_id}`, {
    method: "DELETE"
  });

  loadTimetable();
}

/* ===============================
   INIT
================================ */
loadSubjects();
document.getElementById("className").addEventListener("change", loadTimetable);
</script>


  <script src="js/kaima-chatbot.js"></script>
  <script src="js/session-timeout.js"></script>

  <!-- Footer -->
  <footer>
    Â© 2026 <strong>gradely.info</strong>. All rights reserved. | Powered by RIS<br>
    <a href="terms.html">Terms</a> â€¢ 
    <a href="privacy.html">Privacy</a> â€¢ 
    <a href="refund-policy.html">Refund Policy</a>
  </footer>



</body>
</html>
